# 快打旋風輸入練習器 v2

> Street Fighter 輸入練習工具（含 Hitbox 快捷、SOCD 中立、LOG、上一筆常駐、Gamepad 支援、DP 622/266 啟發式）。

---

## 專案概覽

這是一個純前端、可直接在瀏覽器打開的練習工具。使用者可透過鍵盤或遊戲控制器模擬 8 方向輸入，並在按下行為鍵（出招鍵）時，由系統於時間窗內判斷是否完成指定招式（如：昇龍 623P）。

* **面向切換**：右/左（鏡像 6↔4、3↔1、5 不變）
* **SOCD**：可切換「左右/上下回中」
* **Hitbox 快捷**：允許多種替代路徑（如 DP 的 6-2-2、2-6-6、6-2-8…）
* **LOG 與上一筆常駐**：顯示最近 2.5 秒方向序列、每次判定結果、以及上一次結果的常駐區塊
* **Gamepad**：讀取第一個手把（buttons 12/13/14/15 與左類比）

---

## 檔案結構與職責

```
/ (root)
├─ index.html   # 頁面結構與 UI 控制項（面向、招式選擇、SOCD/Hitbox 切換、重置、Gamepad 開關）
├─ styles.css   # 深色系 UI 風格、九宮格方向盤、LOG 區塊、按鈕/徽章樣式
└─ app.js       # 行為與判定主程式（方向輸入、緩衝、SOCD、判定、統計、LOG、Gamepad）
```

### `index.html`

* 設置主要 UI 區塊：

  * **控制列**：面向開關、招式選擇、Hitbox 模式、SOCD 開關、鍵盤提示、Gamepad 開關/狀態、重置統計。
  * **方向盤**：3×3 九宮格（1\~9 對應↙↓↘←·→↖↑↗），用於高亮目前方向。
  * **統計**：成功/失誤/成功率。
  * **上一筆常駐**：固定顯示最近一次判定結果，直到下一次輸入覆蓋。
  * **判定紀錄（LOG）**：每次「行為鍵」觸發時記錄結果、路徑、演算法。
  * **輸入記錄**：最近 2.5 秒之方向變化序列。

### `styles.css`

* 定義暗色主題變數（背景、面板、重點色、成功/失誤色）。
* 方向盤格狀、LOG 區塊、按鈕、Toggle、徽章、統計卡片、RWD 佈局。

### `app.js`

* **狀態與輸入**

  * `buffer`: 最近 2.5 秒方向事件序列（`{dir,t}`）。
  * 鍵盤：方向鍵 / WASD；**行為鍵**：`J/K/L`（任一）。
  * Gamepad：buttons `12/13/14/15` + 左類比軸；A/B/X/Y 任一視為行為鍵。
  * SOCD：若開啟，左右/上下相抵→回中。
* **面向與鏡像**：面向左勾選時，將招式序列進行 6↔4、3↔1 的鏡像映射。
* **招式表（右向）**：

  * `dp`（昇龍拳 623P）：`seqR=[[6,2,3]]`，並在 *Hitbox 模式* 下接受 `altR`（`[6,2,2]`、`[2,6,6]`、`[6,2,8]` 等）。
  * `fb`（波動拳 236P）：`seqR=[[2,3,6]]`。
  * `tatsu`（旋風腳 214K）：`seqR=[[2,1,4]]`，Hitbox 模式有 `[2,5,4]`、`[2,4,4]`、`[2,2,4]`。
* **判定核心**

  * 時間限制：

    * `stepMs=160`（相鄰步驟最大間隔）
    * `totalMs=430`（整套招式需在此總時限內完成）
    * `punchMs=120`（最後一步完成後，在此寬限內按行為鍵才算 OK）
  * 精確序列比對：在滑動視窗內依序匹配；允許 DP 完成後在 `stepMs` 內補「前（6/4）或中立（5）」來後移錨點。
  * **DP 啟發式**：

    * `6-2-2` 型：兩個「下成份」間必隔非下，且第一個下之前/同時有右成份；兩次下的間距 ≤ `stepMs`。
    * `2-6-6` 型：兩個「右成份」間必隔非右，且第二次右之前曾出現下成份；兩次右的間距 ≤ `stepMs`。
* **統計/輸出**

  * 成功/失誤/成功率更新。
  * 判定紀錄（時間戳、OK/Miss、經由 `exact` 或 `dp_heuristic`、路徑展示）。
  * 上一筆常駐框同步更新。

---

## 操作方式

* **方向**：方向鍵 或 WASD。
* **行為鍵**：`J / K / L` 任一。
* **手把**：勾選「使用搖桿（Gamepad）」後，支援第一個手把；A/B/X/Y 任一視為行為鍵。
* **重置**：清空統計與兩個 LOG（上一筆常駐保留）。

---

## 開發與執行

* 直接開啟 `index.html` 於現代瀏覽器（建議 Chrome/Edge）。
* 若使用 Gamepad：請在使用者互動後（如按鍵）連線手把，瀏覽器才會授權讀取。
* 建議起本地靜態伺服器以避免路徑/權限小問題：

  * Python：`python -m http.server 8080`
  * Node（serve）：`npx serve .`

---

## 未來模組化（建議拆檔）

> 若要持續擴充，建議將 `app.js` 拆分為以下 ES Modules（此專案已預留對應職責）：

```
config.js      # 常數與 DOM 參照
moves.js       # 招式資料、面向鏡像、前方方向（6/4）
socd.js        # SOCD 應用（左右/上下回中）
state.js       # buffer 與計數器（唯一狀態源）
judge.js       # 判定邏輯（精確序列 + DP 啟發式 + 錨點後移）
ui.js          # Stick 高亮、LOG/統計/上一筆渲染
input_keyboard.js  # 鍵盤輸入採集
input_gamepad.js   # Gamepad 輸入採集
main.js        # 組裝入口（事件繫結與重置）
```

此拆分有利於單元測試與獨立演進（例如：僅替換 `judge.js` 就能測不同規則）。

---

## 自訂與調參

* 在 `app.js`（或未來 `config.js`）可調：

  * `stepMs` / `totalMs` / `punchMs` / `deadzone`
* 可在 `moves.js` 增加更多替代路徑或招式。

---

## 瀏覽器支援

* 需要支援 Gamepad API 的現代瀏覽器。
* RWD：≤900px 時改為單欄佈局。

---

## 版本資訊

* `2025-09-09` 
初版三檔拆分（HTML/CSS/JS）
細分JS功能
修正
622 p 模糊判定 
266 p 模糊判定
628 p 兼容鍵盤空白鍵input
更改log顯示紀錄，增加判定區塊
移除可自訂變數區塊，統一預設值 

* `2025-09-10`
628 p 模糊判定 
邏輯更改，拳/腳不再共用按鈕(分離)
新增 方向鍵LOG檢視，

* `2025-09-12`
修復大小寫問題
加入「模式選單」：預設自由模式
新增反應模式（
  *隨機招式＋隨機面向
  *倒數條
  *題數/難度設定

* To do：集中角色技能、分離P/共用按鍵、升龍反應練習模式、迷你龍/肯GIF


